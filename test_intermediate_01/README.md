# Реализация проекта по итогам модуля ```DWH (Data Warehouse)``` 

За основу для формирования учебного DWH была взята модель, полученная при решении Задания 2.6

**Слой RAW**: содержит таблицы, приведенные в условии Задания 2.6 (Информация о продажах, Информация о личных кабинетах покупателей, Информация о промо-акциях), также (для универсализации формирования конечной витрины данных) добавлена таблица, задающая возрастные группы покупателей.

![изображение](https://github.com/UncleJoe1973/1T_course/assets/29273924/9ae3ff40-555e-4d40-b0d1-5494ece8f757)

**Слой Core**: в слой включены сущности _Продажи_, _Покупатели_, _Возрастные категории_, _Категории товаров_, _Бренды товаров_, _Модели товаров_, _Товары_, _Промо-акции_, _Календарь_. Для разрешения связи многие-ко-многим между сущностями Товары и Промо-акции добавлена таблица связей _Товары - Промо-акции_ (необходимость такой таблицы вызвана теем, что в системах BI-аналитики, которые отслеживают направление связей многие-ко-многим, ее отсутствие вызовет некорректное вычисление метрик). Схема DWH приведена на рисунке ниже.

![изображение](https://github.com/UncleJoe1973/1T_course/assets/29273924/99ddecfd-4369-4218-b7cd-42482822fdf9)

Ключевые поля таблиц формировались как хэш-литералы md5 от наименований уникальных экземпляров соответствующих сущностей (кроме сущности _Покупатели_, где использовались значения поля cookies из таблицы слоя row).

**Слой Mart**: для формирования финальной витрины были использованы требования из условия Задания 2.6

![изображение](https://github.com/UncleJoe1973/1T_course/assets/29273924/81a395b1-def3-4283-8e50-083a8cb9bb96)


Контейнер с решением поднимается запуском файла [docker-compose.yml](docker-compose.yml), требуемая витрина данных сохраняется в виде таблицы БД **_Clickhouse_** **data_mart**.

  * Данные слоя Raw базы данных **_PostgreSQL_** загружаются скриптом [01_init_raw.sql](init/01_init_raw.sql), исходные данные находятся в папке [**init/data**](./init/data)
  * Структура слоя Core и его наполнение данными в БД **_PostgreSQL_** формируется скриптом [02_init_core.sql](init/02_init_core.sql)
  * Витрина данных в БД **_PostgreSQL_** формируется скриптом [03_data_mart.sql](init/03_data_mart.sql)
  * Миграция витрины в БД **_Clickhouse_** выполняется скриптом [data_mart.sql](clickhouse/data_mart.sql)
  * Данные БД **_PostgreSQL_** и **_Clickhouse_** сохраняются в соответствующих именованных томах (см. файл [docker-compose.yml](docker-compose.yml)).
