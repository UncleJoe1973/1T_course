# Решение финального задания курса ```Вариант №5```

**Комментарии к решению**

Анализ файла исходных данных показал, что они никак не могут быть отнесены к т.н. большим (Big Data) - размер файла ок. 0,5 Gb, прим. 6,5 млн. строк. Кроме того, условия задачи не подразумевают каких-либо периодических или корректирующих запросов. Исходя из этого, для решения задания был избран следующий набор инструментов:

1. СУБД PostgreSQL - для формирования хранилища данных (raw, core, mart) (условие задачи разрешает использование средств языка SQL)
2. Скрипт на языке Python (библиотеки pandas и psycopg2) - для считывания данных из хранилища и сохранения их в формате parquet)
3. Скрипт на языке Python (библиотеки matplotlib и seaborn) - для формирования визуализации ответа на дополнительный вопрос задачи

(Скрипты пп. 2 и 3 объединены в общий [файл решения](./scrypts/final_scrypt.py)). 

Решение реализовано в виде приложения в контейнере Docker, для запуска необходимо выполнить файл [docker-compose.yml](./docker-compose.yml)

Организация репозитория

![Структура](https://github.com/UncleJoe1973/1T_course/assets/29273924/1aa8ac1b-3474-4ad1-b7b1-da6ea1701426)

Файл исходных данных [yellow_tripdata_2020-01.csv](https://disk.yandex.ru/d/DKeoopbGH1Ttuw) должен быть размещен в папке [row_data](./row_data)

В слой хранилища core были загружены только данные, необходимые для решения поставленной задачи, также при загрузке данные были очищены от артефактов (значения NULL, отрицательные значения стоимостей/расстояний, нелогичные данные по расстоянию).

Для гарантии корректной последовательной отработки контейнеров PostgreSQL и Python в файле [docker-compose.yml](./docker-compose.yml) установлена задержка запуска контейнера Python в 60 секунд (строка отмечена комментарием) (я выполнял задание на ноутбуке с AMD Ryzen 5700 и 16 Gb RAM, полная отработка решения занимала примерно 30 секунд, в случае работы на более слабой технике в команде **'sh -c "sleep 60...'** значение должно быть увеличено).

Из условия задания однозначно не следует, по какой величине следует составлять витрину по "проценту поездок по количеству человек в машине" с т.з. максимальной и минимальной стоимости поездок, поэтому эта витрина рассчитана в двух вариантах (по колонкам исходного файла Fare_amount и Total_amount).

После отработки результаты выполнения сохраняются в папке [result](./result/), соответственно, перед выполнением приложения она дожна быть пустой.

Решение задания

1. [Витрина по проценту поездок по количеству человек в машине (по столбцу Fare_amount)](./result/mart_1f.parquet)
2. [Витрина по проценту поездок по количеству человек в машине (по столбцу Total_amount)](./result/mart_1t.parquet)
3. [Визуализация ответа на дополнительный вопрос](./result/saved_figure.png)
